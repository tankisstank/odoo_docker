<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Actions -->
    <record id="action_report_debt_summary" model="ir.actions.report">
        <field name="name">Debt Summary</field>
        <field name="model">gold.debt.report.wizard</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">gold_shop_debt.report_debt_summary_template</field>
        <field name="report_file">gold_shop_debt.report_debt_summary_template</field>
        <field name="binding_model_id" ref="model_gold_debt_report_wizard"/>
        <field name="binding_type">report</field>
    </record>

    <record id="action_report_debt_detail" model="ir.actions.report">
        <field name="name">Debt Detail</field>
        <field name="model">gold.debt.report.wizard</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">gold_shop_debt.report_debt_detail_template</field>
        <field name="report_file">gold_shop_debt.report_debt_detail_template</field>
        <field name="binding_model_id" ref="model_gold_debt_report_wizard"/>
        <field name="binding_type">report</field>
    </record>

    <!-- Summary Template -->
    <template id="report_debt_summary_template">
        <t t-call="web.html_container">
            <t t-call="web.external_layout">
                <div class="page">
                    <h2 class="text-center">Bảng kê Công nợ Rút gọn</h2>
                    <div class="text-center mb-4">
                        Từ ngày: <span t-esc="data.get('date_from')"/> - Đến ngày: <span t-esc="data.get('date_to')"/>
                    </div>
                    
                    <table class="table table-sm table-bordered">
                        <thead>
                            <tr>
                                <th>Khách hàng</th>
                                <th class="text-right">Số dư đầu kỳ</th>
                                <th class="text-right">Phát sinh Tăng (Mua)</th>
                                <th class="text-right">Phát sinh Giảm (Trả/Bán)</th>
                                <th class="text-right">Số dư cuối kỳ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <t t-foreach="docs" t-as="partner_data">
                                <tr>
                                    <td><span t-esc="partner_data['name']"/></td>
                                    <td class="text-right"><span t-esc="partner_data['opening']" t-options='{"widget": "monetary", "display_currency": res_company.currency_id}'/></td>
                                    <td class="text-right"><span t-esc="partner_data['debit']" t-options='{"widget": "monetary", "display_currency": res_company.currency_id}'/></td>
                                    <td class="text-right"><span t-esc="partner_data['credit']" t-options='{"widget": "monetary", "display_currency": res_company.currency_id}'/></td>
                                    <td class="text-right"><span t-esc="partner_data['closing']" t-options='{"widget": "monetary", "display_currency": res_company.currency_id}'/></td>
                                </tr>
                            </t>
                        </tbody>
                    </table>
                </div>
            </t>
        </t>
    </template>

    <!-- Detail Template -->
    <template id="report_debt_detail_template">
        <t t-call="web.html_container">
            <t t-call="web.external_layout">
                <div class="page">
                    <h2 class="text-center">Bảng kê Công nợ Chi tiết</h2>
                    <div class="text-center mb-4">
                        Từ ngày: <span t-esc="data.get('date_from')"/> - Đến ngày: <span t-esc="data.get('date_to')"/>
                    </div>

                    <t t-foreach="docs" t-as="partner">
                        <h4 class="mt-4"><span t-esc="partner['name']"/></h4>
                        <table class="table table-sm table-bordered">
                            <thead>
                                <tr>
                                    <th>Ngày</th>
                                    <th>Số CT</th>
                                    <th>Diễn giải</th>
                                    <th>Hàng hóa</th>
                                    <th class="text-right">SL</th>
                                    <th class="text-right">Đơn giá</th>
                                    <th class="text-right">Nợ (Mua)</th>
                                    <th class="text-right">Có (Trả/Bán)</th>
                                    <th class="text-right">Tồn</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Opening Balance Row -->
                                <tr>
                                    <td colspan="6" class="font-weight-bold">Số dư đầu kỳ</td>
                                    <td></td>
                                    <td></td>
                                    <td class="text-right font-weight-bold">
                                        <span t-esc="partner['opening']" t-options='{"widget": "monetary", "display_currency": res_company.currency_id}'/>
                                    </td>
                                </tr>
                                <!-- Transactions -->
                                <t t-foreach="partner['lines']" t-as="line">
                                    <tr>
                                        <td><span t-esc="line['date']"/></td>
                                        <td><span t-esc="line['ref']"/></td>
                                        <td><span t-esc="line['name']"/></td>
                                        <td><span t-esc="line['product']"/></td>
                                        <td class="text-right"><span t-esc="line['qty']"/></td>
                                        <td class="text-right"><span t-esc="line['price']" t-options='{"widget": "monetary", "display_currency": res_company.currency_id}'/></td>
                                        <td class="text-right"><span t-esc="line['debit']" t-options='{"widget": "monetary", "display_currency": res_company.currency_id}'/></td>
                                        <td class="text-right"><span t-esc="line['credit']" t-options='{"widget": "monetary", "display_currency": res_company.currency_id}'/></td>
                                        <td class="text-right"><span t-esc="line['balance']" t-options='{"widget": "monetary", "display_currency": res_company.currency_id}'/></td>
                                    </tr>
                                </t>
                                <!-- Closing Balance Row -->
                                <tr>
                                    <td colspan="6" class="font-weight-bold">Số dư cuối kỳ</td>
                                    <td class="text-right font-weight-bold"><span t-esc="partner['total_debit']" t-options='{"widget": "monetary", "display_currency": res_company.currency_id}'/></td>
                                    <td class="text-right font-weight-bold"><span t-esc="partner['total_credit']" t-options='{"widget": "monetary", "display_currency": res_company.currency_id}'/></td>
                                    <td class="text-right font-weight-bold">
                                        <span t-esc="partner['closing']" t-options='{"widget": "monetary", "display_currency": res_company.currency_id}'/>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </t>
                </div>
            </t>
        </t>
    </template>
</odoo>
